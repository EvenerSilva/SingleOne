<!-- üéØ HEADER DO FORMUL√ÅRIO -->
<div class="form-header">
  <h2 class="form-title">Visualiza√ß√£o do Sinistro</h2>
  <p class="form-subtitle">
    Visualize as informa√ß√µes detalhadas do sinistro t√©cnico
  </p>
</div>

<!-- üìã CONTE√öDO PRINCIPAL -->
<div class="laudo-form-container">
  <div class="info-grid">
    <!-- üñ•Ô∏è EQUIPAMENTO -->
    <div class="info-section">
      <h3>Equipamento</h3>
      <div class="info-value">{{laudo.equipamento}}</div>
    </div>

    <!-- üî¢ INFORMA√á√ïES T√âCNICAS -->
    <div class="info-section">
      <h3>Informa√ß√µes T√©cnicas</h3>
      <div class="info-row">
        <span class="info-label">N√∫mero de S√©rie:</span>
        <span class="info-value">{{laudo.numeroserie}}</span>
      </div>
      <div class="info-row">
        <span class="info-label">Patrim√¥nio:</span>
        <span class="info-value">{{laudo.patrimonio}}</span>
      </div>
    </div>

    <!-- üìù CARACTER√çSTICAS -->
    <div class="info-section">
      <h3>Caracter√≠sticas de Abertura</h3>
      <div class="info-value">{{laudo.descricao}}</div>
    </div>

    <!-- üß™ LAUDO FINAL -->
    <div class="info-section">
      <h3>Laudo Final</h3>
      <div class="info-value">{{laudo.laudo}}</div>
    </div>

    <!-- üë®‚Äçüíº T√âCNICO -->
    <div class="info-section">
      <h3>T√©cnico Analista</h3>
      <div class="info-value">{{laudo.tecniconome}}</div>
    </div>

    <!-- ‚úÖ AVALIA√á√ïES -->
    <div class="info-section">
      <h3>Avalia√ß√µes</h3>
      <div class="avaliacoes-list">
        <div class="avaliacao-item">
          <mat-checkbox [(ngModel)]="laudo.temconserto" readonly disabled>
            Teve conserto?
          </mat-checkbox>
        </div>
        <div class="avaliacao-item">
          <mat-checkbox [(ngModel)]="laudo.mauuso" readonly disabled>
            Caracteriza mau uso?
          </mat-checkbox>
        </div>
      </div>
    </div>

    <!-- üìÖ DATAS -->
    <div class="info-section">
      <h3>Datas</h3>
      <div class="datas-list">
        <div class="data-item">
          <span class="data-label">Entrada:</span>
          <span class="data-value">{{laudo.dtentrada | dateFormat:1}}</span>
        </div>
        <div class="data-item">
          <span class="data-label">Finaliza√ß√£o:</span>
          <span class="data-value">{{laudo.dtlaudo | dateFormat:1}}</span>
        </div>
      </div>
    </div>

    <!-- üì∏ EVID√äNCIAS -->
    <div class="info-section evidencias-section">
      <div class="evidencias-header">
        <h3>Evid√™ncias ({{evidencias.length}}/6)</h3>
        <button *ngIf="!carregandoEvidencias" 
                class="btn btn-outline-primary" 
                (click)="adicionarEvidencias()">
          <i class="cil-plus"></i>
          Adicionar Evid√™ncias
        </button>
      </div>
      
      <!-- Loading -->
      <div *ngIf="carregandoEvidencias" class="loading-evidencias">
        <p>Carregando evid√™ncias...</p>
      </div>

      <!-- Lista de evid√™ncias -->
      <div *ngIf="!carregandoEvidencias && evidencias.length > 0" 
           class="evidencias-list" 
           style="display: grid !important; grid-template-columns: repeat(3, 1fr) !important; grid-template-rows: repeat(2, auto) !important; gap: 1rem !important; width: 100% !important; max-width: 100% !important; overflow: visible !important; flex-direction: unset !important; flex-wrap: unset !important; flex: unset !important;">
        <div *ngFor="let evidencia of evidencias; trackBy: trackByEvidencia" 
             class="evidencia-item"
             style="max-width: 200px !important; width: auto !important; margin: 0 !important; display: block !important; float: none !important; clear: none !important; flex: unset !important; flex-basis: unset !important; flex-grow: unset !important; flex-shrink: unset !important;">
          
          <!-- Modo visualiza√ß√£o -->
          <div *ngIf="editandoEvidencia?.id !== evidencia.id" class="evidencia-view">
            <div class="evidencia-info">
              <div class="evidencia-ordem">{{evidencia.ordem}}</div>
              
                                  <!-- üñºÔ∏è MINIATURA DA EVID√äNCIA -->
                    <div class="evidencia-preview" 
                         style="width: 80px !important; height: 80px !important; max-width: 80px !important; max-height: 80px !important; overflow: hidden !important;">
                      <div *ngIf="isImageFile(evidencia.nomearquivo)" 
                           class="image-thumbnail"
                           style="width: 100% !important; height: 100% !important; overflow: hidden !important;">
                        <img [src]="getEvidenciaPreview(evidencia)" 
                             [alt]="evidencia.nomearquivo"
                             style="width: 100% !important; height: 100% !important; object-fit: cover !important;" />
                      </div>
                      <div *ngIf="!isImageFile(evidencia.nomearquivo)" 
                           class="file-icon"
                           style="width: 100% !important; height: 100% !important;">
                        <i [class]="getFileIcon(evidencia.nomearquivo)"></i>
                      </div>
                    </div>
              
                              <div class="evidencia-details">
                  <div class="evidencia-nome">{{getDisplayFileName(evidencia.nomearquivo, evidencia)}}</div>
                  <div class="evidencia-size" *ngIf="evidencia.tamanho">{{formatFileSize(evidencia.tamanho)}}</div>
                </div>
              
              <div class="evidencia-actions">
                <button class="btn btn-success btn-sm" (click)="downloadEvidencia(evidencia)" title="Download" matTooltip="Download da evid√™ncia">
                  <i class="cil-cloud-download"></i>
                </button>
                <button class="btn btn-primary btn-sm" (click)="iniciarEdicao(evidencia)" title="Editar ordem" matTooltip="Editar ordem da evid√™ncia">
                  <i class="cil-pencil"></i>
                </button>
                <button class="btn btn-danger btn-sm" (click)="excluirEvidencia(evidencia)" title="Excluir" matTooltip="Excluir evid√™ncia">
                  <i class="cil-trash"></i>
                </button>
              </div>
            </div>
          </div>

          <!-- Modo edi√ß√£o -->
          <div *ngIf="editandoEvidencia?.id === evidencia.id" class="evidencia-edit">
            <div class="edit-form">
              <label>Nova ordem:</label>
              <input type="number" [(ngModel)]="novaOrdem" min="1" [max]="evidencias.length">
              <div class="edit-buttons">
                <button class="btn-save" (click)="salvarEdicao()">Salvar</button>
                <button class="btn-cancel" (click)="cancelarEdicao()">Cancelar</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sem evid√™ncias -->
      <div *ngIf="!carregandoEvidencias && evidencias.length === 0" class="sem-evidencias">
        <p>Nenhuma evid√™ncia encontrada.</p>
      </div>
    </div>
  </div>
  
  <!-- üéØ FOOTER COM BOT√ÉO DE CANCELAR -->
  <div class="form-footer">
    <button class="btn-cancel" (click)="fecharVisualizacao()">
      <i class="cil-x"></i>
      Fechar
    </button>
  </div>
</div>