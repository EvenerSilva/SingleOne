<!-- üéØ HEADER MODERNO DAS LINHAS -->
<div class="linhas-header">
  <div class="header-content">
    <div class="header-left">
      <div class="back-button" (click)="voltarParaTelecom()">
        <i class="cil-arrow-left"></i>
      </div>
      
      <div class="header-title">
        <div class="title-icon">
          <i class="cil-phone"></i>
        </div>
        
        <div class="title-text">
          <h1>Linhas</h1>
          <p>Gest√£o de linhas telef√¥nicas</p>
        </div>
      </div>
    </div>
    
    <div class="header-right">
      <!-- üÜï BOT√ÉO DE FILTRO PARA LINHAS LIVRES -->
      <button class="filter-btn" (click)="filtrarLinhasLivres()" [class.active]="filtroLinhasLivresAtivo">
        <div class="filter-content">
          <i class="cil-filter"></i>
          <span>Linhas Livres</span>
          <div class="filter-totalizador" *ngIf="totalizadores">
            <span class="total-livre">{{ totalizadores.livres }}</span>
            <span class="total-separator">/</span>
            <span class="total-em-uso">{{ totalizadores.emUso }}</span>
          </div>
        </div>
      </button>
      
      <button class="action-btn" (click)="novo()">
        <i class="cil-plus"></i>
        <span>Nova Linha</span>
      </button>
    </div>
  </div>
</div>

<!-- üçû BREADCRUMB MODERNO -->
<div class="modern-breadcrumb">
  <div class="breadcrumb-container">
    <a class="breadcrumb-item" (click)="voltarParaTelecom()">
      <i class="cil-home"></i>
      <span>Telecom</span>
    </a>
    <i class="cil-chevron-right"></i>
    <a class="breadcrumb-item" (click)="navegarParaOperadoras()">
      <i class="cil-building"></i>
      <span>Operadoras</span>
    </a>
    <i class="cil-chevron-right"></i>
    <a class="breadcrumb-item" (click)="navegarParaContas()">
      <i class="cil-credit-card"></i>
      <span>Contas</span>
    </a>
    <i class="cil-chevron-right"></i>
    <a class="breadcrumb-item" (click)="navegarParaPlanos()">
      <i class="cil-list"></i>
      <span>Planos</span>
    </a>
    <i class="cil-chevron-right"></i>
    <span class="breadcrumb-item active">Linhas</span>
  </div>
</div>

<!-- üìã CONTE√öDO PRINCIPAL -->
<div class="linhas-content">
  <!-- üîç SE√á√ÉO DE BUSCA -->
  <div class="search-section">
    <div class="search-box">
      <i class="cil-magnifying-glass search-icon"></i>
      <input 
        type="text" 
        placeholder="Buscar pelo n√∫mero, operadora, conta ou plano..." 
        [formControl]="consulta"
        class="form-control">
      <button 
        *ngIf="consulta.value" 
        class="clear-btn" 
        (click)="limparBusca()"
        type="button">
        <i class="cil-x"></i>
      </button>
    </div>
  </div>

  <!-- üìä TABELA MODERNA -->
  <div class="table-section">
    <table mat-table [dataSource]="dataSource" class="modern-table">
      <!-- Coluna Operadora -->
      <ng-container matColumnDef="operadora">
        <th mat-header-cell *matHeaderCellDef>Operadora</th>
        <td mat-cell *matCellDef="let row">
          {{ row.planoNavigation.contratoNavigation.operadoraNavigation.nome }}
        </td>
      </ng-container>

      <!-- Coluna Conta -->
      <ng-container matColumnDef="contrato">
        <th mat-header-cell *matHeaderCellDef>Conta</th>
        <td mat-cell *matCellDef="let row">
          {{ row.planoNavigation.contratoNavigation.nome }}
        </td>
      </ng-container>

      <!-- Coluna Plano -->
      <ng-container matColumnDef="plano">
        <th mat-header-cell *matHeaderCellDef>Plano</th>
        <td mat-cell *matCellDef="let row">{{ row.planoNavigation.nome }}</td>
      </ng-container>

      <!-- Coluna N√∫mero -->
      <ng-container matColumnDef="numero">
        <th mat-header-cell *matHeaderCellDef>N√∫mero</th>
        <td mat-cell *matCellDef="let row">
          <!-- ‚úÖ Link para entregas apenas quando a linha estiver em uso -->
          <a
            *ngIf="row.emuso"
            [routerLink]="['/movimentacoes/entregas-devolucoes', row.numero]"
            class="numero-link"
            [matTooltip]="'Clique para ver entregas desta linha'">
            {{ row.numero }}
          </a>
          
          <!-- ‚úÖ N√∫mero simples quando a linha n√£o estiver em uso -->
          <span *ngIf="!row.emuso" class="numero-simples">
            {{ row.numero }}
          </span>
        </td>
      </ng-container>

      <!-- Coluna ICCID -->
      <ng-container matColumnDef="iccid">
        <th mat-header-cell *matHeaderCellDef>ICCID</th>
        <td mat-cell *matCellDef="let row">{{ row.iccid }}</td>
      </ng-container>

      <!-- Coluna Em Uso -->
      <ng-container matColumnDef="emuso">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let row">
          <div class="status-indicator" [class.em-uso]="row.emuso" [class.livre]="!row.emuso">
            <i [class]="row.emuso ? 'cil-check' : 'cil-ban'"></i>
            <span>{{ row.emuso ? 'Em Uso' : 'Livre' }}</span>
          </div>
        </td>
      </ng-container>

      <!-- Coluna A√ß√µes -->
      <ng-container matColumnDef="acao">
        <th mat-header-cell *matHeaderCellDef class="text-center">A√ß√µes</th>
        <td mat-cell *matCellDef="let row" class="text-center">
          <div class="action-buttons">
            <!-- Bot√£o Timeline/Hist√≥rico -->
            <button 
              class="action-btn timeline-btn" 
              matTooltip="Ver Hist√≥rico"
              (click)="redirectToTimelineLinha(row.id)">
              <i class="material-icons">history</i>
            </button>
            
            <button 
              class="action-btn edit-btn" 
              matTooltip="Editar"
              (click)="editar(row)"
              *ngIf="!row.emuso">
              <i class="cil-pencil"></i>
            </button>
            
            <button 
              class="action-btn delete-btn" 
              matTooltip="Excluir"
              (click)="excluir(row)"
              *ngIf="!row.emuso">
              <i class="cil-trash"></i>
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="colunas"></tr>
      <tr mat-row *matRowDef="let row; columns: colunas"></tr>
    </table>
  </div>

  <!-- üìÑ PAGINA√á√ÉO -->
  <div class="pagination-container">
    <mat-paginator
      [pageSizeOptions]="[5, 10, 25, 100]"
      [pageSize]="10"
      showFirstLastButtons>
    </mat-paginator>
  </div>
</div>

<!-- üéØ FORMUL√ÅRIO DE LINHA (MODAL) -->
<div class="formulario-overlay" *ngIf="mostrarFormulario">
  <div class="formulario-container">
    <app-linha
      [linha]="linhaEditando"
      [modo]="modoFormulario"
      (linhaSalva)="onLinhaSalva($event)"
      (cancelado)="onCancelado()"
    ></app-linha>
  </div>
</div>
