<!-- üéØ HEADER MODERNO DOS CARGOS DE CONFIAN√áA -->
<div class="cargosconfianca-header">
  <div class="header-content">
    <div class="header-left">
      <button class="back-button" [routerLink]="['/configuracoes']" matTooltip="Voltar para Configura√ß√µes">
        <i class="cil-arrow-left"></i>
      </button>
      <div class="header-title">
        <div class="title-icon">
          <i class="cil-lock-locked"></i>
        </div>
        <div class="title-text">
          <h1>Cargos de Confian√ßa</h1>
          <p>Gerenciar cargos que requerem processos especiais de seguran√ßa no descarte</p>
        </div>
      </div>
    </div>
    <div class="header-right">
      <button class="action-btn primary-btn" (click)="abrirFormulario()" matTooltip="Adicionar novo cargo de confian√ßa">
        <i class="cil-plus"></i>
        <span>Novo Cargo</span>
      </button>
    </div>
  </div>
</div>

<!-- üçû BREADCRUMB MODERNO -->
<nav class="modern-breadcrumb">
  <div class="breadcrumb-container">
    <a [routerLink]="['/dashboard']" class="breadcrumb-item">
      <i class="cil-home"></i>
      <span>Dashboard</span>
    </a>
    <i class="cil-chevron-right"></i>
    <a [routerLink]="['/configuracoes']" class="breadcrumb-item">
      <i class="cil-cog"></i>
      <span>Configura√ß√µes</span>
    </a>
    <i class="cil-chevron-right"></i>
    <span class="breadcrumb-item active">Cargos de Confian√ßa</span>
  </div>
</nav>

<!-- üìã CONTE√öDO PRINCIPAL -->
<div class="cargosconfianca-content">
  
  <!-- üîí CONFIGURA√á√ÉO DE NOVO CARGO (COLAPS√ÅVEL) -->
  <div class="config-section" [class.expanded]="mostrarFormulario">
    <div class="section-header" (click)="toggleFormulario()">
      <div class="header-content">
        <div class="header-icon">
          <i class="cil-shield-alt"></i>
        </div>
        <div class="header-text">
          <h2>{{editandoCargo ? 'Editar' : 'Adicionar'}} Cargo de Confian√ßa</h2>
          <p>Configure cargos que requerem processos especiais de seguran√ßa no descarte</p>
        </div>
        <div class="header-toggle">
          <i class="cil-chevron-bottom" [class.rotated]="mostrarFormulario"></i>
        </div>
      </div>
    </div>
    
    <div class="config-content" *ngIf="mostrarFormulario">
      <form [formGroup]="form" (ngSubmit)="editandoCargo ? salvarEdicao() : adicionarCargo()">
        <div class="form-layout">
          <!-- LADO ESQUERDO: Cargo e Criticidade -->
          <div class="form-left">
            <div class="form-section">
              <h4>Informa√ß√µes do Cargo</h4>
              
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Cargo ou Padr√£o de Cargo</mat-label>
                <input matInput formControlName="cargo" required 
                       placeholder="Ex: Gerente, Diretor, Presidente, etc.">
                <mat-hint>Digite o nome do cargo ou um padr√£o para agrupar cargos similares</mat-hint>
                <mat-error *ngIf="form.get('cargo')?.invalid && form.get('cargo')?.touched">
                  Cargo √© obrigat√≥rio
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>N√≠vel de Criticidade</mat-label>
                <mat-select formControlName="nivelcriticidade" required>
                  <mat-option value="ALTO">ALTO</mat-option>
                  <mat-option value="MEDIO">M√âDIO</mat-option>
                  <mat-option value="BAIXO">BAIXO</mat-option>
                </mat-select>
              </mat-form-field>

              <div class="padrao-section">
                <mat-checkbox formControlName="matchexato" class="padrao-checkbox" color="warn">
                  <div class="padrao-info">
                    <div class="padrao-title">
                      <i class="material-icons">warning</i>
                      <strong>Cargo Exato (Exce√ß√£o)</strong>
                    </div>
                    <span class="padrao-hint">
                      <strong>Padr√£o (desmarcado):</strong> Usa match parcial. Ex: "Gerente" incluir√° "Gerente I", "Gerente II", "Gerente Regional", etc.<br>
                      <strong>Exce√ß√£o (marcado):</strong> Apenas o cargo exato. Ex: "Presidente" incluir√° SOMENTE quem tem cargo exatamente "Presidente".
                    </span>
                  </div>
                </mat-checkbox>
              </div>
            </div>
          </div>

          <!-- LADO DIREITO: Processos Obrigat√≥rios -->
          <div class="form-right">
            <div class="form-section">
              <h4>Processos Obrigat√≥rios</h4>
              
              <div class="processos-grid">
                <mat-checkbox formControlName="obrigarsanitizacao" class="processo-checkbox" color="primary">
                  <div class="processo-content">
                    <i class="material-icons">cleaning_services</i>
                    <span>Sanitiza√ß√£o</span>
                  </div>
                </mat-checkbox>

                <mat-checkbox formControlName="obrigardescaracterizacao" class="processo-checkbox" color="primary">
                  <div class="processo-content">
                    <i class="material-icons">remove_circle</i>
                    <span>Descaracteriza√ß√£o</span>
                  </div>
                </mat-checkbox>

                <mat-checkbox formControlName="obrigarperfuracaodisco" class="processo-checkbox" color="primary">
                  <div class="processo-content">
                    <i class="material-icons">storage</i>
                    <span>Perfura√ß√£o de Disco</span>
                  </div>
                </mat-checkbox>

                <mat-checkbox formControlName="obrigarevidencias" class="processo-checkbox evidencias-especial" color="warn"
                              matTooltip="Se marcado, exige evid√™ncias FOTOGR√ÅFICAS de TODOS os processos selecionados acima">
                  <div class="processo-content">
                    <i class="material-icons">photo_library</i>
                    <div class="processo-text">
                      <span class="processo-nome">Exigir Evid√™ncias Fotogr√°ficas</span>
                      <small class="processo-hint">Anexar fotos de CADA processo marcado</small>
                    </div>
                  </div>
                </mat-checkbox>
              </div>
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="cancelarEdicao()" *ngIf="editandoCargo || mostrarFormulario">
            <i class="material-icons">close</i>
            Cancelar
          </button>
          <button type="submit" class="btn-primary" [disabled]="form.invalid || carregando">
            <i class="material-icons">{{editandoCargo ? 'save' : 'add'}}</i>
            {{editandoCargo ? 'Salvar Altera√ß√µes' : 'Adicionar Cargo'}}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- üîç SE√á√ÉO DE BUSCA -->
  <div class="search-section">
    <div class="search-box">
      <i class="cil-magnifying-glass search-icon"></i>
      <input type="text" placeholder="Buscar por cargo, criticidade, tipo de match ou processos..." [formControl]="consulta">
      <button 
        *ngIf="consulta.value" 
        class="clear-btn" 
        (click)="limparBusca()"
        type="button">
        <i class="cil-x"></i>
      </button>
    </div>
  </div>

  <!-- üìä TABELA MODERNA -->
  <div class="table-section">
    <div class="table-container">
      <table class="modern-table">
        <thead>
          <tr>
            <th>Cargo</th>
            <th class="text-center">Criticidade</th>
            <th>Tipo de Match</th>
            <th>Processos Obrigat√≥rios</th>
            <th class="text-center">Status</th>
            <th class="text-center">A√ß√µes</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let cargo of dadosPaginados" [class.inativo]="!cargo.ativo">
            <td class="cargo-info">
              <div class="cargo-details">
                <div class="cargo-text">
                  <span class="cargo-nome">{{cargo.cargo}}</span>
                  <small class="cargo-meta">Criado em: {{cargo.datacriacao | date:'dd/MM/yyyy'}}</small>
                </div>
              </div>
            </td>
            <td class="text-center">
              <span class="criticidade-badge" [class]="getNivelCriticidadeClass(cargo.nivelcriticidade)">
                {{cargo.nivelcriticidade}}
              </span>
            </td>
            <td>
              <span class="match-badge" [ngClass]="cargo.usarpadrao ? 'padrao' : 'exato'">
                <i [class]="cargo.usarpadrao ? 'cil-search' : 'cil-check-circle'"></i>
                {{cargo.usarpadrao ? 'Padr√£o' : 'Exato'}}
              </span>
            </td>
            <td>
              <div class="processos-list">
                <span class="processo-tag" *ngFor="let processo of getProcessosObrigatorios(cargo)">
                  {{processo}}
                </span>
              </div>
            </td>
            <td class="text-center">
              <span class="status-badge" [ngClass]="cargo.ativo ? 'ativo' : 'inativo'">
                <i [class]="cargo.ativo ? 'cil-check-circle' : 'cil-x-circle'"></i>
                {{cargo.ativo ? 'ATIVO' : 'INATIVO'}}
              </span>
            </td>
            <td class="cargo-actions">
              <div class="action-buttons">
                <button class="action-btn toggle-btn" matTooltip="Ativar/Desativar" (click)="toggleAtivo(cargo)">
                  <i [class]="cargo.ativo ? 'cil-check-circle' : 'cil-ban'"></i>
                </button>
                <button class="action-btn edit-btn" matTooltip="Editar cargo" (click)="editarCargo(cargo)">
                  <i class="cil-pencil"></i>
                </button>
                <button class="action-btn delete-btn" matTooltip="Excluir cargo" (click)="excluirCargo(cargo.id)">
                  <i class="cil-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- üìÑ PAGINA√á√ÉO -->
  <div class="pagination-container">
    <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" [pageSize]="10" showFirstLastButtons></mat-paginator>
  </div>
</div>
