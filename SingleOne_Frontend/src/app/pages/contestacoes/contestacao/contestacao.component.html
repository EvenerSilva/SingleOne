<!-- üéØ HEADER MODERNO DA CONTESTA√á√ÉO -->
<div class="contestacao-header">
  <div class="header-content">
    <div class="header-left">
      <button class="back-button" [routerLink]="['/movimentacoes/contestacoes']" matTooltip="Voltar para Contesta√ß√µes">
        <i class="cil-arrow-left"></i>
      </button>
      <div class="header-title">
        <div class="title-icon">
          <i class="cil-clipboard"></i>
        </div>
        <div class="title-text">
          <h1>{{ getTituloAtendimento() }}</h1>
          <p>{{ getSubtituloAtendimento() }}</p>
        </div>
      </div>
    </div>
    
    <div class="header-right" *ngIf="isEditMode && podeResolver()">
      <button class="action-btn success-btn" (click)="resolverContestacao()" 
              [matTooltip]="tipoContestacao === 'auto_inventario' ? 'Resolver auto invent√°rio' : tipoContestacao === 'inventario_forcado' ? 'Resolver invent√°rio for√ßado' : 'Resolver contesta√ß√£o'">
        <i class="cil-check-circle"></i>
        <span>Resolver</span>
      </button>
      <!-- Bot√£o diferente para Auto Invent√°rio / Invent√°rio For√ßado vs Contesta√ß√£o -->
      <button *ngIf="tipoContestacao === 'auto_inventario' || tipoContestacao === 'inventario_forcado'" 
              class="action-btn danger-btn" 
              (click)="cancelarAutoInventario()" 
              [matTooltip]="tipoContestacao === 'inventario_forcado' ? 'Cancelar invent√°rio for√ßado' : 'Cancelar solicita√ß√£o de auto invent√°rio'">
        <i class="cil-x-circle"></i>
        <span>Cancelar</span>
      </button>
      <button *ngIf="tipoContestacao !== 'auto_inventario' && tipoContestacao !== 'inventario_forcado'" 
              class="action-btn danger-btn" 
              (click)="negarContestacao()" 
              matTooltip="Negar contesta√ß√£o">
        <i class="cil-thumb-down"></i>
        <span>Negar</span>
      </button>
    </div>
  </div>
</div>

<!-- üçû BREADCRUMB MODERNO -->
<nav class="modern-breadcrumb">
  <div class="breadcrumb-container">
    <a [routerLink]="['/dashboard']" class="breadcrumb-item">
      <i class="cil-home"></i>
      <span>Dashboard</span>
    </a>
    <i class="cil-chevron-right"></i>
    <a [routerLink]="['/movimentacoes']" class="breadcrumb-item">
      <i class="cil-transfer"></i>
      <span>Solicita√ß√µes</span>
    </a>
    <i class="cil-chevron-right"></i>
    <a [routerLink]="['/movimentacoes/contestacoes']" class="breadcrumb-item">
      <i class="cil-clipboard"></i>
      <span>Contesta√ß√µes</span>
    </a>
    <i class="cil-chevron-right"></i>
    <span class="breadcrumb-item active">{{ getBreadcrumbAtivo() }}</span>
  </div>
</nav>

<!-- üìã CONTE√öDO PRINCIPAL -->
<div class="contestacao-content" *ngIf="!isLoading">
  <div class="form-container">
    
    <!-- üìä SE√á√ÉO DE INFORMA√á√ïES B√ÅSICAS -->
    <div class="form-section">
      <div class="section-header">
        <div class="section-icon">
          <i class="cil-info"></i>
        </div>
        <div class="section-title">
          <h3>Informa√ß√µes B√°sicas</h3>
          <p>Dados principais da contesta√ß√£o</p>
        </div>
      </div>
      
      <div class="form-grid">
        <!-- ID e Status -->
        <div class="info-card" *ngIf="isEditMode">
          <div class="info-label">
            <i class="cil-hash"></i>
            ID da Contesta√ß√£o
          </div>
          <div class="info-value">#{{ contestacao?.id }}</div>
        </div>

        <div class="info-card" *ngIf="isEditMode">
          <div class="info-label">
            <i class="cil-flag"></i>
            Status
          </div>
          <div class="info-value">
            <span class="status-badge" [class]="getStatusClass(contestacao?.statusId)">
              {{ getStatusLabel(contestacao?.statusId) }}
            </span>
          </div>
        </div>

        <!-- Colaborador -->
        <div class="info-card">
          <div class="info-label">
            <i class="cil-user"></i>
            Colaborador
          </div>
          <div class="info-value">
            <strong>{{ contestacao?.colaborador?.nome || 'N/A' }}</strong>
            <small>ID: {{ contestacao?.colaboradorId }}</small>
          </div>
        </div>

        <!-- Equipamento -->
        <div class="info-card">
          <div class="info-label">
            <i class="cil-devices"></i>
            {{ getLabelEquipamento() }}
          </div>
          <div class="info-value">
            <strong>{{ getValorEquipamento() }}</strong>
            <small>{{ getLabelNumeroSerie() }}: {{ contestacao?.equipamento?.numeroSerie || 'N/A' }}</small>
          </div>
        </div>

        <!-- Data da Contesta√ß√£o -->
        <div class="info-card">
          <div class="info-label">
            <i class="cil-calendar"></i>
            Data da Contesta√ß√£o
          </div>
          <div class="info-value">
            {{ contestacao?.dataContestacao | date: 'dd/MM/yyyy HH:mm' }}
          </div>
        </div>

        <!-- T√©cnico Respons√°vel -->
        <div class="info-card" *ngIf="isEditMode && contestacao?.tecnicoResponsavel">
          <div class="info-label">
            <i class="cil-user-follow"></i>
            T√©cnico Respons√°vel
          </div>
          <div class="info-value">
            {{ contestacao?.tecnicoResponsavel }}
          </div>
        </div>
      </div>
    </div>

    <!-- üìù SE√á√ÉO DE DETALHES DA CONTESTA√á√ÉO -->
    <div class="form-section">
      <div class="section-header">
        <div class="section-icon">
          <i class="cil-description"></i>
        </div>
        <div class="section-title">
          <h3>Detalhes da Contesta√ß√£o</h3>
          <p>Informa√ß√µes sobre o motivo e descri√ß√£o</p>
        </div>
      </div>
      
      <div class="details-content">
        <!-- Motivo -->
        <div class="detail-block">
          <div class="detail-label">
            <i class="cil-warning"></i>
            Motivo da Contesta√ß√£o
          </div>
          <div class="detail-value">
            {{ contestacao?.motivo || 'N/A' }}
          </div>
        </div>

        <!-- Descri√ß√£o -->
        <div class="detail-block">
          <div class="detail-label">
            <i class="cil-text"></i>
            Descri√ß√£o Detalhada
          </div>
          <div class="detail-value">
            {{ contestacao?.descricao || 'N/A' }}
          </div>
        </div>
      </div>
    </div>

    <!-- ‚úÖ SE√á√ÉO DE RESOLU√á√ÉO -->
    <div class="form-section" *ngIf="isEditMode">
      <div class="section-header">
        <div class="section-icon">
          <i class="cil-check-circle"></i>
        </div>
        <div class="section-title">
          <h3>Resolu√ß√£o</h3>
          <p>Informa√ß√µes sobre a resolu√ß√£o da contesta√ß√£o</p>
        </div>
      </div>
      
      <div class="details-content">
        <!-- Formul√°rio de Resolu√ß√£o -->
        <div class="detail-block" *ngIf="podeResolver()">
          <div class="detail-label">
            <i class="cil-text"></i>
            Observa√ß√µes da Resolu√ß√£o *
          </div>
          <textarea 
            [(ngModel)]="observacoesResolucao"
            (blur)="observacoesTouched = true"
            [class.has-error]="temErroObservacoes()"
            class="modern-textarea"
            rows="5"
            placeholder="Descreva como a contesta√ß√£o foi resolvida..."></textarea>
          
          <div class="field-error" *ngIf="temErroObservacoes()">
            <i class="cil-warning"></i>
            <span *ngIf="!observacoesResolucao || observacoesResolucao.trim().length === 0">
              Campo obrigat√≥rio. Por favor, preencha as observa√ß√µes da resolu√ß√£o.
            </span>
            <span *ngIf="observacoesResolucao && observacoesResolucao.trim().length > 0 && observacoesResolucao.trim().length < 10">
              M√≠nimo de 10 caracteres. Voc√™ digitou {{ observacoesResolucao.trim().length }} caracteres.
            </span>
          </div>
          
          <div class="field-help" *ngIf="!temErroObservacoes()">
            <small>
              <i class="cil-info"></i>
              Obrigat√≥rio para resolu√ß√£o da contesta√ß√£o (m√≠nimo 10 caracteres)
            </small>
          </div>
        </div>

        <!-- Exibi√ß√£o de Resolu√ß√£o Existente -->
        <div class="detail-block" *ngIf="!podeResolver()">
          <div class="detail-label">
            <i class="cil-text"></i>
            Observa√ß√µes da Resolu√ß√£o
          </div>
          <div class="detail-value" *ngIf="contestacao?.observacaoResolucao">
            {{ contestacao?.observacaoResolucao }}
          </div>
          <div class="alert-info" *ngIf="!contestacao?.observacaoResolucao">
            <i class="cil-info"></i>
            Nenhuma observa√ß√£o de resolu√ß√£o registrada.
          </div>
        </div>

        <!-- Informa√ß√µes de Resolu√ß√£o -->
        <div class="form-grid" *ngIf="contestacao?.dataResolucao">
          <div class="info-card">
            <div class="info-label">
              <i class="cil-calendar"></i>
              Data de Resolu√ß√£o
            </div>
            <div class="info-value">
              {{ contestacao.dataResolucao | date: 'dd/MM/yyyy HH:mm' }}
            </div>
          </div>

          <div class="info-card" *ngIf="contestacao?.tecnicoResponsavel">
            <div class="info-label">
              <i class="cil-user-follow"></i>
              Resolvido por
            </div>
            <div class="info-value">
              {{ contestacao.tecnicoResponsavel }}
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- ‚è≥ LOADING -->
<div class="loading-state" *ngIf="isLoading">
  <div class="loading-content">
    <div class="loading-spinner">
      <i class="cil-sync"></i>
    </div>
    <h3>Carregando contesta√ß√£o...</h3>
    <p>Aguarde enquanto buscamos as informa√ß√µes</p>
  </div>
</div>
