<!-- üéØ HEADER MODERNO DAS CONTESTA√á√ïES -->
<div class="contestacoes-header">
  <div class="header-content">
    <div class="header-left">
      <button class="back-button" [routerLink]="['/movimentacoes']">
        <i class="cil-arrow-left"></i>
      </button>
      <div class="header-title">
        <div class="title-icon">
          <i class="cil-clipboard"></i>
        </div>
        <div class="title-text">
          <h1>Gest√£o de Contesta√ß√µes</h1>
          <p>Atendimento e controle de contesta√ß√µes patrimoniais</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- üçû BREADCRUMB MODERNO -->
<nav class="modern-breadcrumb">
  <div class="breadcrumb-container">
    <a [routerLink]="['/dashboard']" class="breadcrumb-item">
      <i class="cil-home"></i>
      <span>Dashboard</span>
    </a>
    <i class="cil-chevron-right"></i>
    <a [routerLink]="['/movimentacoes']" class="breadcrumb-item">
      <i class="cil-transfer"></i>
      <span>Solicita√ß√µes</span>
    </a>
    <i class="cil-chevron-right"></i>
    <span class="breadcrumb-item active">Contesta√ß√µes</span>
  </div>
</nav>

<!-- üéØ ABAS PARA DIVIDIR POR TIPO -->
<div class="tabs-section">
  <mat-tab-group #tabGroup (selectedTabChange)="trocarAba($event)" class="modern-tabs">
    <mat-tab>
      <ng-template mat-tab-label>
        <span class="tab-label"><span>Contesta√ß√µes</span><span class="tab-badge" [class.zero]="getPendentesContestacoes() === 0">{{getPendentesContestacoes()}}</span></span>
      </ng-template>
      <div class="tab-content">
        <!-- üìä CARDS DE ESTAT√çSTICAS - CONTESTA√á√ïES -->
        <div class="stats-section">
          <div class="stats-grid">
            <div class="stat-card total" (click)="filtrarPorStatusCard('Total')" title="Clique para ver todas as contesta√ß√µes">
              <div class="stat-content">
                <div class="stat-number">{{getTotalContestacoes()}}</div>
                <div class="stat-label">Total de Contesta√ß√µes</div>
              </div>
            </div>
            
            <div class="stat-card pending" (click)="filtrarPorStatusCard('pendente')" title="Clique para ver contesta√ß√µes pendentes">
              <div class="stat-content">
                <div class="stat-number">{{getContestacoesPendentes()}}</div>
                <div class="stat-label">Pendentes</div>
              </div>
            </div>
            
            <div class="stat-card resolved" (click)="filtrarPorStatusCard('resolvida')" title="Clique para ver contesta√ß√µes resolvidas">
              <div class="stat-content">
                <div class="stat-number">{{getContestacoesResolvidas()}}</div>
                <div class="stat-label">Resolvidas</div>
              </div>
            </div>
            
            <div class="stat-card cancelled" (click)="filtrarPorStatusCard('cancelada')" title="Clique para ver contesta√ß√µes canceladas">
              <div class="stat-content">
                <div class="stat-number">{{getContestacoesCanceladas()}}</div>
                <div class="stat-label">Canceladas</div>
              </div>
            </div>
            
            <div class="stat-card denied" (click)="filtrarPorStatusCard('negada')" title="Clique para ver contesta√ß√µes negadas">
              <div class="stat-content">
                <div class="stat-number">{{getContestacoesNegadas()}}</div>
                <div class="stat-label">Negadas</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </mat-tab>
    
    <mat-tab>
      <ng-template mat-tab-label>
        <span class="tab-label"><span>Auto Invent√°rio</span><span class="tab-badge" [class.zero]="getPendentesAutoInventario() === 0">{{getPendentesAutoInventario()}}</span></span>
      </ng-template>
      <div class="tab-content">
        <!-- üìä CARDS DE ESTAT√çSTICAS - AUTO INVENT√ÅRIO -->
        <div class="stats-section">
          <div class="stats-grid">
            <div class="stat-card total" (click)="filtrarPorStatusCard('Total')" title="Clique para ver todas as solicita√ß√µes de auto invent√°rio">
              <div class="stat-content">
                <div class="stat-number">{{getTotalContestacoes()}}</div>
                <div class="stat-label">Total de Solicita√ß√µes</div>
              </div>
            </div>
            
            <div class="stat-card pending" (click)="filtrarPorStatusCard('pendente')" title="Clique para ver solicita√ß√µes pendentes">
              <div class="stat-content">
                <div class="stat-number">{{getContestacoesPendentes()}}</div>
                <div class="stat-label">Pendentes</div>
              </div>
            </div>
            
            <div class="stat-card resolved" (click)="filtrarPorStatusCard('resolvida')" title="Clique para ver solicita√ß√µes resolvidas">
              <div class="stat-content">
                <div class="stat-number">{{getContestacoesResolvidas()}}</div>
                <div class="stat-label">Resolvidas</div>
              </div>
            </div>
            
            <div class="stat-card cancelled" (click)="filtrarPorStatusCard('cancelada')" title="Clique para ver solicita√ß√µes canceladas">
              <div class="stat-content">
                <div class="stat-number">{{getContestacoesCanceladas()}}</div>
                <div class="stat-label">Canceladas</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </mat-tab>
    
    <mat-tab>
      <ng-template mat-tab-label>
        <span class="tab-label"><span>Invent√°rio For√ßado</span><span class="tab-badge" [class.zero]="getPendentesInventarioForcado() === 0">{{getPendentesInventarioForcado()}}</span></span>
      </ng-template>
      <div class="tab-content">
        <!-- üìä CARDS DE ESTAT√çSTICAS - INVENT√ÅRIO FOR√áADO -->
        <div class="stats-section">
          <div class="stats-grid">
            <div class="stat-card total" (click)="filtrarPorStatusCard('Total')" title="Clique para ver todos os invent√°rios for√ßados">
              <div class="stat-content">
                <div class="stat-number">{{getTotalContestacoes()}}</div>
                <div class="stat-label">Total de Invent√°rios</div>
              </div>
            </div>
            
            <div class="stat-card pending" (click)="filtrarPorStatusCard('pendente')" title="Clique para ver invent√°rios pendentes">
              <div class="stat-content">
                <div class="stat-number">{{getContestacoesPendentes()}}</div>
                <div class="stat-label">Pendentes</div>
              </div>
            </div>
            
            <div class="stat-card resolved" (click)="filtrarPorStatusCard('resolvida')" title="Clique para ver invent√°rios resolvidos">
              <div class="stat-content">
                <div class="stat-number">{{getContestacoesResolvidas()}}</div>
                <div class="stat-label">Conclu√≠dos</div>
              </div>
            </div>
            
            <div class="stat-card cancelled" (click)="filtrarPorStatusCard('cancelada')" title="Clique para ver invent√°rios cancelados">
              <div class="stat-content">
                <div class="stat-number">{{getContestacoesCanceladas()}}</div>
                <div class="stat-label">Cancelados</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>

<!-- üîç SE√á√ÉO DE BUSCA E FILTROS -->
<div class="search-filters-section">
  <div class="search-filters-content">
    <!-- üîç Campo de Busca -->
    <div class="search-box">
      <i class="cil-magnifying-glass search-icon"></i>
      <input 
        type="text" 
        placeholder="Buscar por n√∫mero da contesta√ß√£o, colaborador, equipamento ou status..." 
        [formControl]="consulta">
      <button 
        *ngIf="consulta.value" 
        class="clear-btn" 
        (click)="limparBusca()"
        type="button">
        <i class="cil-x"></i>
      </button>
    </div>
  </div>
</div>

<!-- üìã TABELA MODERNA DE CONTESTA√á√ïES -->
<div class="table-section">
  <div class="table-container">
    <table class="modern-table">
      <thead>
        <tr>
          <th>{{tipoFiltro === 'auto_inventario' ? 'Solicita√ß√£o' : tipoFiltro === 'inventario_forcado' ? 'Invent√°rio For√ßado' : 'Contesta√ß√£o'}}</th>
          <th>Status</th>
          <th>Colaborador</th>
          <th>{{tipoFiltro === 'auto_inventario' ? 'N√∫mero de S√©rie' : 'Equipamento'}}</th>
          <th>{{tipoFiltro === 'auto_inventario' ? 'Data Solicita√ß√£o' : tipoFiltro === 'inventario_forcado' ? 'Data Invent√°rio' : 'Data Contesta√ß√£o'}}</th>
          <th>T√©cnico Respons√°vel</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let row of dadosPaginados" 
            class="table-row" 
            [class.contestacao-urgente]="isContestacaoUrgente(row)"
            [matTooltip]="getAlertaContestacao(row)"
            [matTooltipDisabled]="!isContestacaoUrgente(row)"
            matTooltipClass="alerta-tooltip"
            [matTooltipPosition]="'above'"
            [matTooltipShowDelay]="500">
          <td class="id-cell">
            <span class="contestacao-id">{{ tipoFiltro === 'auto_inventario' ? 'Auto Invent√°rio ' + getContestacaoId(row) : tipoFiltro === 'inventario_forcado' ? 'Invent√°rio For√ßado ' + getContestacaoId(row) : getContestacaoNome(row) }}</span>
          </td>
          
          <td class="status-cell">
            <span class="status-badge" [class]="getStatusClass(getContestacaoStatus(row))">
              {{ getContestacaoStatus(row) }}
            </span>
          </td>
          
          <td class="user-cell">
            <div class="user-info clickable" 
                 (click)="navegarParaTimelineColaborador(row)" 
                 [matTooltip]="'Ver timeline de ' + getContestacaoColaborador(row)"
                 matTooltipPosition="above">
              <i class="cil-user"></i>
              <span class="link-text">{{ getContestacaoColaborador(row) }}</span>
              <i class="cil-external-link link-icon"></i>
            </div>
          </td>
          
          <td class="equipment-cell">
            <div class="equipment-info">
              <i class="cil-devices"></i>
              <div class="equipment-details clickable" 
                   *ngIf="tipoFiltro === 'contestacao'"
                   (click)="navegarParaTimelineRecurso(row)"
                   [matTooltip]="'Ver timeline de ' + getContestacaoEquipamentoFormatado(row)"
                   matTooltipPosition="above">
                <span class="equipment-name link-text">{{ getContestacaoEquipamentoFormatado(row) }}</span>
                <small class="equipment-serial">{{ getLabelNumeroSerie(row) }}: {{ getContestacaoNumeroSerie(row) }}</small>
                <i class="cil-external-link link-icon-small"></i>
              </div>
              <div class="equipment-details" *ngIf="tipoFiltro === 'auto_inventario' || tipoFiltro === 'inventario_forcado'">
                <span class="equipment-name">{{ row?.descricao || row?.Descricao || 'N/A' }}</span>
                <small class="equipment-serial">N√∫mero de S√©rie</small>
              </div>
            </div>
          </td>
          
          <td class="date-cell">
            <div class="date-info">
              <i class="cil-calendar"></i>
              <span>{{ getContestacaoDataCriacao(row) }}</span>
            </div>
          </td>
          
          <td class="responsible-cell">
            <div class="user-info">
              <i class="cil-user-follow"></i>
              <span>{{ getContestacaoTecnico(row) }}</span>
            </div>
          </td>
          
          <td class="actions-cell">
            <div class="action-buttons">
              <button 
                class="btn btn-sm btn-primary" 
                [matTooltip]="getContestacaoStatusId(row) == 1 || getContestacaoStatusId(row) == 2 ? 'Atender Contesta√ß√£o' : 'Ver Detalhes'"
                (click)="editarContestacao(row)"
              >
                <i [class]="getContestacaoStatusId(row) == 1 || getContestacaoStatusId(row) == 2 ? 'cil-clipboard' : 'cil-search'"></i>
                <span class="btn-text">{{ getContestacaoStatusId(row) == 1 || getContestacaoStatusId(row) == 2 ? 'Atender' : 'Visualizar' }}</span>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    
    <!-- üìä INFORMA√á√ïES DA TABELA -->
    <div class="table-info" *ngIf="dataSource?.data">
      <div class="info-text">
        <div class="info-left">
          <span>Mostrando {{dadosPaginados.length}} de {{dataSource.data.length}} registros</span>
          <span class="info-total" *ngIf="dadosCompletos.length > 0">
            | Total no sistema: {{dadosCompletos.length}} contesta√ß√µes
          </span>
        </div>
        <div class="info-right">
          <span class="info-historico" *ngIf="temFiltroAtivo()">
            <i class="cil-info"></i>
            Filtro ativo: {{ getFiltroAtivo() }}
          </span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- üìÑ PAGINA√á√ÉO -->
<div class="pagination-container" *ngIf="dataSource?.data?.length > 0">
  <mat-paginator 
    [pageSizeOptions]="[5, 10, 25, 50, 100]" 
    [pageSize]="10" 
    showFirstLastButtons>
  </mat-paginator>
</div>

<!-- Estado vazio -->
<div class="empty-state" *ngIf="!dataSource?.data || dataSource.data.length === 0">
  <div class="empty-icon">
    <i [class]="tipoFiltro === 'auto_inventario' ? 'cil-devices' : tipoFiltro === 'inventario_forcado' ? 'cil-clipboard' : 'cil-clipboard'"></i>
  </div>
  <h3>Nenhum{{tipoFiltro === 'inventario_forcado' ? '' : 'a'}} {{tipoFiltro === 'auto_inventario' ? 'solicita√ß√£o de auto invent√°rio' : tipoFiltro === 'inventario_forcado' ? 'invent√°rio for√ßado' : 'contesta√ß√£o'}} encontrad{{tipoFiltro === 'inventario_forcado' ? 'o' : 'a'}}</h3>
  <p>N√£o h√° {{tipoFiltro === 'auto_inventario' ? 'solicita√ß√µes' : tipoFiltro === 'inventario_forcado' ? 'invent√°rios for√ßados' : 'contesta√ß√µes'}} cadastrados ou ajuste os filtros de busca</p>
</div>
