<!-- üéØ HEADER MODERNO DAS POL√çTICAS DE ELEGIBILIDADE -->
<div class="politicas-header">
  <div class="header-content">
    <div class="header-left">
      <button class="back-button" [routerLink]="['/configuracoes']" matTooltip="Voltar para Configura√ß√µes">
        <i class="cil-arrow-left"></i>
      </button>
      <div class="header-title">
        <div class="title-icon">
          <i class="cil-shield-alt"></i>
        </div>
        <div class="title-text">
          <h1>Pol√≠ticas de Elegibilidade</h1>
          <p>Gerencie quais perfis podem ter acesso a recursos</p>
        </div>
      </div>
    </div>
    <div class="header-right">
      <button class="action-btn primary-btn" (click)="abrirModalNovo()" matTooltip="Adicionar nova pol√≠tica">
        <i class="cil-plus"></i>
        <span>Nova Pol√≠tica</span>
      </button>
    </div>
  </div>
</div>

<!-- üçû BREADCRUMB MODERNO -->
<nav class="modern-breadcrumb">
  <div class="breadcrumb-container">
    <a [routerLink]="['/dashboard']" class="breadcrumb-item">
      <i class="cil-home"></i>
      <span>Dashboard</span>
    </a>
    <i class="cil-chevron-right"></i>
    <a [routerLink]="['/configuracoes']" class="breadcrumb-item">
      <i class="cil-cog"></i>
      <span>Configura√ß√µes</span>
    </a>
    <i class="cil-chevron-right"></i>
    <span class="breadcrumb-item active">Pol√≠ticas de Elegibilidade</span>
  </div>
</nav>

<!-- üìã CONTE√öDO PRINCIPAL -->
<div class="politicas-content">
  <!-- üîç SE√á√ÉO DE BUSCA -->
  <div class="search-section">
    <div class="search-box">
      <i class="cil-magnifying-glass search-icon"></i>
      <input type="text" placeholder="Buscar por tipo de colaborador ou recurso..." [formControl]="consulta">
      <button 
        *ngIf="consulta.value" 
        class="clear-btn" 
        (click)="limparBusca()"
        type="button">
        <i class="cil-x"></i>
      </button>
    </div>
  </div>

  <!-- üìä TABELA MODERNA -->
  <div class="table-section">
    <div class="table-container">
      <table class="modern-table">
        <thead>
          <tr>
            <th>Tipo de Colaborador</th>
            <th>Cargo</th>
            <th>Tipo de Recurso</th>
            <th class="text-center">Permite Acesso</th>
            <th class="text-center">Qtd. M√°xima</th>
            <th class="text-center">A√ß√µes</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let row of dadosPaginados">
            <td class="politica-colaborador">
              <div class="politica-info">
                <div class="politica-avatar">
                  <i class="cil-user"></i>
                </div>
                <div class="politica-details">
                  <span class="politica-tipo">{{row.tipoColaboradorDescricao}}</span>
                </div>
              </div>
            </td>
            <td class="politica-cargo">
              <div *ngIf="row.cargo" class="cargo-info">
                <span class="cargo-nome">{{row.cargo}}</span>
                <span class="cargo-tipo-badge" [ngClass]="getTipoBuscaClass(row)">
                  {{getTipoBuscaCargo(row)}}
                </span>
              </div>
              <span *ngIf="!row.cargo" class="cargo-todos">Todos os cargos</span>
            </td>
            <td class="politica-recurso">
              <div class="recurso-badge">
                <i class="cil-devices"></i>
                <span>{{row.tipoEquipamentoDescricao}}</span>
              </div>
            </td>
            <td class="text-center">
              <span class="status-badge" [ngClass]="row.permiteAcesso ? 'permitido' : 'negado'">
                <i [class]="row.permiteAcesso ? 'cil-check-circle' : 'cil-x-circle'"></i>
                {{row.permiteAcesso ? 'SIM' : 'N√ÉO'}}
              </span>
            </td>
            <td class="text-center">
              <span class="quantidade-badge" *ngIf="row.permiteAcesso && row.quantidadeMaxima">
                {{row.quantidadeMaxima}}
              </span>
              <span class="ilimitado" *ngIf="row.permiteAcesso && !row.quantidadeMaxima">
                Ilimitado
              </span>
              <span class="na" *ngIf="!row.permiteAcesso">‚Äî</span>
            </td>
            <td class="politica-actions">
              <div class="action-buttons">
                <button class="action-btn edit-btn" matTooltip="Editar pol√≠tica" (click)="abrirModalEditar(row)">
                  <i class="cil-pencil"></i>
                </button>
                <button class="action-btn delete-btn" matTooltip="Excluir pol√≠tica" (click)="confirmarExclusao(row)">
                  <i class="cil-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- üìÑ PAGINA√á√ÉO -->
  <div class="pagination-container">
    <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" [pageSize]="10" showFirstLastButtons></mat-paginator>
  </div>
</div>

<!-- üéØ MODAL POL√çTICA DE ELEGIBILIDADE - BASEADO NO MODAL DE ESTOQUE M√çNIMO -->
<div class="formulario-overlay" *ngIf="showModal" (click)="fecharModal()">
  <div class="formulario-container" (click)="$event.stopPropagation()">
    <div class="fabricante-form-container">
      
      <!-- Header do Formul√°rio -->
      <div class="form-header">
        <h2 class="form-title">
          <i class="cil-shield-alt"></i>
          {{ politicaAtual.id === 0 ? 'Nova Pol√≠tica de Elegibilidade' : 'Editar Pol√≠tica de Elegibilidade' }}
        </h2>
        <p class="form-subtitle">
          {{ politicaAtual.id === 0 ? 'Configure regras de acesso e quantidade de recursos para colaboradores' : 'Edite as regras de acesso e quantidade de recursos para colaboradores' }}
        </p>
      </div>

      <form #politicaForm="ngForm" class="fabricante-form">
        
        <!-- Tipo de Pol√≠tica: Permiss√£o ou Nega√ß√£o -->
        <div class="form-group">
          <label class="form-label">
            <i class="cil-shield-alt"></i>
            Tipo de Pol√≠tica <span class="required">*</span>
          </label>
          <div class="policy-type-buttons">
            <button 
              type="button"
              class="policy-btn"
              [class.active]="politicaAtual.permiteAcesso === true"
              (click)="politicaAtual.permiteAcesso = true">
              <i class="cil-check-circle"></i>
              <div class="btn-content">
                <strong>Permiss√£o</strong>
                <small>Permitir acesso ao recurso</small>
              </div>
            </button>
            <button 
              type="button"
              class="policy-btn deny"
              [class.active]="politicaAtual.permiteAcesso === false"
              (click)="politicaAtual.permiteAcesso = false; politicaAtual.quantidadeMaxima = null;">
              <i class="cil-ban"></i>
              <div class="btn-content">
                <strong>Nega√ß√£o</strong>
                <small>Negar acesso ao recurso</small>
              </div>
            </button>
          </div>
          <small class="form-text text-muted">
            Escolha se esta pol√≠tica vai permitir ou negar acesso ao tipo de recurso
          </small>
        </div>
        
        <!-- Tipo de Colaborador -->
        <div class="form-group">
          <label for="tipoColaborador" class="form-label">
            <i class="cil-people"></i>
            Tipo de Colaborador <span class="required">*</span>
          </label>
          <select 
            id="tipoColaborador"
            [(ngModel)]="politicaAtual.tipoColaborador" 
            name="tipoColaborador" 
            class="form-control"
            [class.is-invalid]="politicaForm.submitted && !politicaAtual.tipoColaborador"
            required>
            <option value="">Selecione o tipo de colaborador</option>
            <option 
              *ngFor="let tipo of tiposColaboradorDisponiveis; trackBy: trackByTipo" 
              [value]="tipo.codigo">
              {{tipo.descricao}}
            </option>
          </select>
          <div class="invalid-feedback" *ngIf="politicaForm.submitted && !politicaAtual.tipoColaborador">
            <span>Tipo de colaborador √© obrigat√≥rio</span>
          </div>
          <small class="form-text text-muted">
            Selecione o tipo de colaborador que ter√° esta pol√≠tica aplicada
          </small>
        </div>

        <!-- Cargo Espec√≠fico -->
        <div class="form-group">
          <label for="cargo" class="form-label">
            <i class="cil-briefcase"></i>
            Cargo Espec√≠fico (opcional)
          </label>
          <input 
            type="text"
            id="cargo"
            [(ngModel)]="politicaAtual.cargo" 
            name="cargo" 
            class="form-control"
            placeholder="Ex: Analista, Gerente, Diretor">
          <small class="form-text text-muted">
            Deixe em branco para aplicar a todos os cargos do tipo selecionado
          </small>
        </div>

        <!-- Usar Padr√£o (s√≥ aparece se cargo estiver preenchido) -->
        <div class="form-group checkbox-group" *ngIf="politicaAtual.cargo">
          <label class="checkbox-container">
            <input 
              type="checkbox" 
              [(ngModel)]="politicaAtual.usarPadrao" 
              name="usarPadrao">
            <span class="checkbox-label">Usar busca por padr√£o (cont√©m)</span>
          </label>
          <small class="form-text text-muted" *ngIf="politicaAtual.usarPadrao">
            ‚úì Se informar "Analista", qualquer cargo que contenha "Analista" entrar√° na regra
          </small>
          <small class="form-text text-muted warning-text" *ngIf="!politicaAtual.usarPadrao">
            ‚ö† Apenas o cargo exato ser√° considerado (match preciso)
          </small>
        </div>

        <!-- Tipo de Recurso -->
        <div class="form-group">
          <label for="tipoEquipamento" class="form-label">
            <i class="cil-laptop"></i>
            Tipo de Recurso <span class="required">*</span>
          </label>
          <select 
            id="tipoEquipamento"
            [(ngModel)]="politicaAtual.tipoEquipamentoId" 
            name="tipoEquipamento" 
            class="form-control"
            [class.is-invalid]="politicaForm.submitted && !politicaAtual.tipoEquipamentoId"
            required>
            <option value="">Selecione o tipo de recurso</option>
            <option 
              *ngFor="let tipo of tiposEquipamentoDisponiveis; trackBy: trackByEquipamento" 
              [value]="tipo.id">
              {{tipo.descricao}}
            </option>
          </select>
          <div class="invalid-feedback" *ngIf="politicaForm.submitted && !politicaAtual.tipoEquipamentoId">
            <span>Tipo de recurso √© obrigat√≥rio</span>
          </div>
          <small class="form-text text-muted">
            Selecione o tipo de recurso para aplicar a pol√≠tica
          </small>
        </div>

        <!-- Quantidade M√°xima (s√≥ aparece para pol√≠ticas de Permiss√£o) -->
        <div class="form-group" *ngIf="politicaAtual.permiteAcesso === true">
          <label for="quantidadeMaxima" class="form-label">
            <i class="cil-calculator"></i>
            Quantidade M√°xima
          </label>
          <input 
            type="number"
            id="quantidadeMaxima"
            [(ngModel)]="politicaAtual.quantidadeMaxima" 
            name="quantidadeMaxima" 
            class="form-control"
            min="1"
            placeholder="Ex: 2">
          <small class="form-text text-muted">
            Deixe vazio para ilimitado
          </small>
        </div>

        <!-- Observa√ß√µes -->
        <div class="form-group">
          <label for="observacoes" class="form-label">
            <i class="cil-notes"></i>
            Observa√ß√µes
          </label>
          <textarea 
            id="observacoes"
            [(ngModel)]="politicaAtual.observacoes" 
            name="observacoes" 
            class="form-control"
            rows="3"
            placeholder="Justificativa ou observa√ß√µes sobre esta pol√≠tica"></textarea>
          <small class="form-text text-muted">
            Informa√ß√µes adicionais sobre esta pol√≠tica
          </small>
        </div>

        <!-- Bot√µes de A√ß√£o -->
        <div class="form-actions">
          <button
            type="button"
            class="btn btn-secondary"
            (click)="fecharModal()">
            <i class="fas fa-times"></i>
            Cancelar
          </button>
        
          <button
            type="button"
            class="btn btn-primary"
            (click)="salvar()">
            <i class="fas fa-save"></i>
            {{ politicaAtual.id === 0 ? 'Cadastrar' : 'Salvar' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- MODAL: CONFIRMAR EXCLUS√ÉO -->
<div class="modal-overlay" *ngIf="showDeleteModal" (click)="fecharModalExcluir()">
  <div class="modal-container modal-small" (click)="$event.stopPropagation()">
    <div class="modal-header danger">
      <h2>
        <i class="material-icons">warning</i>
        Confirmar Exclus√£o
      </h2>
      <button mat-icon-button (click)="fecharModalExcluir()">
        <i class="material-icons">close</i>
      </button>
    </div>

    <div class="modal-content">
      <p>Deseja realmente excluir esta pol√≠tica de elegibilidade?</p>
      <div class="politica-info" *ngIf="politicaExcluir">
        <strong>{{politicaExcluir.tipoColaboradorDescricao}}</strong> 
        ‚Üí
        <strong>{{politicaExcluir.tipoEquipamentoDescricao}}</strong>
      </div>
      <p class="warning-text">
        <i class="material-icons">info</i>
        Esta a√ß√£o n√£o pode ser desfeita!
      </p>
    </div>

    <div class="modal-footer">
      <button mat-button (click)="fecharModalExcluir()">Cancelar</button>
      <button mat-raised-button color="warn" (click)="excluir()">
        <i class="material-icons">delete</i>
        Excluir
      </button>
    </div>
  </div>
</div>

