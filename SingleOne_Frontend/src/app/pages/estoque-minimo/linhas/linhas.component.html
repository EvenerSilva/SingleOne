<!-- üìä CONTE√öDO PRINCIPAL -->
<div class="linhas-content">
  
  <!-- üìä RESUMO ESTAT√çSTICO COM FILTROS -->
  <div class="summary-section">
    <div class="summary-cards">
      <div class="summary-card" 
           [class.active]="isCardAtivo('TODOS')"
           (click)="filtrarPorCard('TODOS')">
        <div class="card-icon">
          <i class="cil-phone"></i>
        </div>
        <div class="card-content">
          <h3>{{ totalLinhas }}</h3>
          <p>Total de Linhas</p>
        </div>
        <div class="card-filter-indicator" *ngIf="isCardAtivo('TODOS')">
          <i class="cil-check"></i>
        </div>
      </div>
      
      <div class="summary-card" 
           [class.active]="isCardAtivo('ALERTA')"
           (click)="filtrarPorCard('ALERTA')">
        <div class="card-icon alerta">
          <i class="cil-warning"></i>
        </div>
        <div class="card-content">
          <h3>{{ linhasEmAlerta }}</h3>
          <p>Em Alerta</p>
        </div>
        <div class="card-filter-indicator" *ngIf="isCardAtivo('ALERTA')">
          <i class="cil-check"></i>
        </div>
      </div>
      
      <div class="summary-card" 
           [class.active]="isCardAtivo('EXCESSO')"
           (click)="filtrarPorCard('EXCESSO')">
        <div class="card-icon excesso">
          <i class="cil-x-circle"></i>
        </div>
        <div class="card-content">
          <h3>{{ linhasEmExcesso }}</h3>
          <p>Em Excesso</p>
        </div>
        <div class="card-filter-indicator" *ngIf="isCardAtivo('EXCESSO')">
          <i class="cil-check"></i>
        </div>
      </div>
      
      <div class="summary-card" 
           [class.active]="isCardAtivo('OK')"
           (click)="filtrarPorCard('OK')">
        <div class="card-icon ok">
          <i class="cil-check-circle"></i>
        </div>
        <div class="card-content">
          <h3>{{ linhasOk }}</h3>
          <p>OK</p>
        </div>
        <div class="card-filter-indicator" *ngIf="isCardAtivo('OK')">
          <i class="cil-check"></i>
        </div>
      </div>
    </div>
  </div>
  
  <!-- üîç FILTRO ATIVO -->
  <div class="active-filter-section" *ngIf="filtroAtivo !== 'TODOS'">
    <div class="active-filter-info">
      <i class="cil-filter"></i>
      <span>Filtro ativo: <strong>{{ filtroAtivo }}</strong></span>
      <span class="filter-count">({{ linhasFiltradas.length }} de {{ totalLinhas }} linhas)</span>
      <button class="btn-clear-filter" (click)="limparFiltros()">
        <i class="cil-x"></i>
        <span>Limpar filtro</span>
      </button>
    </div>
  </div>

  <!-- üìã TABELA DE LINHAS -->
  <div class="table-section">
    <div class="table-container">
      <table class="modern-table">
        <thead>
          <tr>
            <th>Linha</th>
            <th>Localidade</th>
            <th>Total Lan√ßado</th>
            <th>Estoque Atual</th>
            <th>Estoque M√≠nimo</th>
            <th>Estoque M√°ximo</th>
            <th>% Utiliza√ß√£o</th>
            <th>Status</th>
            <th class="text-center">A√ß√µes</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let linha of linhasParaExibicao">
            <td class="linha-info">
              <div class="linha-detalhes">
                <div class="linha-avatar">
                  <i class="cil-phone"></i>
                </div>
                <div class="linha-texto">
                  <div class="linha-tipo">{{ getOperadoraDescricaoGrid(linha) }}</div>
                  <div class="linha-serial">Plano: {{ linha.planoDescricao || 'N/A' }}</div>
                </div>
              </div>
            </td>
            <td class="linha-localizacao">
              <div class="localidade-info">
                <i class="cil-location-pin"></i>
                <span>{{ getLocalidadeDescricaoGrid(linha) }}</span>
              </div>
            </td>
            <td class="linha-total-lancado">
              <div class="estoque-total-lancado">
                <span class="quantidade-numero">{{ linha.quantidadeTotalLancada || linha.quantidadetotallancada || 0 }}</span>
                <span class="quantidade-label">total</span>
              </div>
            </td>
            <td class="linha-estoque">
              <div class="estoque-atual">
                <span class="quantidade-numero">{{ linha.estoqueAtual || 0 }}</span>
                <span class="quantidade-label">unidades</span>
              </div>
            </td>
            <td class="linha-minimo">
              <div class="estoque-minimo">
                <span class="quantidade-numero">{{ linha.quantidadeMinima || linha.quantidademinima || 0 }}</span>
                <span class="quantidade-label">m√≠nimo</span>
              </div>
            </td>
            <td class="linha-maximo">
              <div class="estoque-maximo">
                <span class="quantidade-numero">{{ linha.quantidadeMaxima || linha.quantidademaxima || 0 }}</span>
                <span class="quantidade-label">m√°ximo</span>
              </div>
            </td>
            <td class="linha-utilizacao">
              <div class="percentual-container">
                <div class="percentual-bar">
                  <div class="percentual-fill" 
                       [style.width.%]="getPercentualUtilizacao(linha)"
                       [class.alta]="getPercentualUtilizacao(linha) > 80"
                       [class.media]="getPercentualUtilizacao(linha) > 60 && getPercentualUtilizacao(linha) <= 80"
                       [class.baixa]="getPercentualUtilizacao(linha) <= 60">
                  </div>
                </div>
                <span class="percentual-text" 
                      [class.alta]="getPercentualUtilizacao(linha) > 80"
                      [class.media]="getPercentualUtilizacao(linha) > 60 && getPercentualUtilizacao(linha) <= 80"
                      [class.baixa]="getPercentualUtilizacao(linha) <= 60">
                  {{ getPercentualUtilizacao(linha) }}%
                </span>
              </div>
            </td>
            <td class="linha-status">
              <div class="status-container" 
                   [class.has-tooltip]="getStatusLinha(linha) === 'ALERTA' || getStatusLinha(linha) === 'EXCESSO'">
                <div class="status-label" 
                     [class.status-alerta]="getStatusLinha(linha) === 'ALERTA'"
                     [class.status-excesso]="getStatusLinha(linha) === 'EXCESSO'"
                     [class.status-ok]="getStatusLinha(linha) === 'OK'">
                  <i [class]="getStatusLinha(linha) === 'ALERTA' ? 'cil-warning' : 
                             getStatusLinha(linha) === 'EXCESSO' ? 'cil-x-circle' : 'cil-check-circle'"></i>
                  {{ getStatusLinha(linha) }}
                </div>
                <div class="status-tooltip" 
                     *ngIf="getStatusLinha(linha) === 'ALERTA' || getStatusLinha(linha) === 'EXCESSO'">
                  <span *ngIf="getStatusLinha(linha) === 'ALERTA'" class="tooltip-text alerta-tooltip">
                    Alerta! Estoque atual menor ou igual que estoque m√≠nimo programado
                  </span>
                  <span *ngIf="getStatusLinha(linha) === 'EXCESSO'" class="tooltip-text excesso-tooltip">
                    Excesso! Estoque atual igual ou maior que estoque m√°ximo programado
                  </span>
                </div>
              </div>
            </td>
            <td class="linha-actions text-center">
              <div class="action-buttons">
                <button class="action-btn edit-btn" 
                        matTooltip="Editar configura√ß√£o" 
                        (click)="editarLinha(linha)">
                  <i class="cil-pencil"></i>
                </button>
                <button class="action-btn view-btn" 
                        matTooltip="Ver linhas" 
                        (click)="navegarParaLinhasFiltradas(linha)">
                  <i class="cil-external-link"></i>
                </button>
                <button class="action-btn delete-btn" 
                        matTooltip="Excluir configura√ß√£o" 
                        (click)="excluirLinha(linha)">
                  <i class="cil-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- üìÑ PAGINA√á√ÉO -->
  <div class="pagination-container">
    <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" [pageSize]="10" showFirstLastButtons></mat-paginator>
  </div>

</div>

<!-- üéØ MODAL ESTOQUE M√çNIMO DE LINHAS -->
<div class="formulario-overlay" *ngIf="mostrarModal" (click)="fecharModal()">
  <div class="formulario-container" (click)="$event.stopPropagation()">
    <div class="fabricante-form-container">
      
      <!-- Header do Formul√°rio -->
      <div class="form-header">
        <h2 class="form-title">
          <i class="cil-phone"></i>
          {{ modo === 'criar' ? 'Nova Linha' : 'Editar Linha' }}
        </h2>
        <p class="form-subtitle">
          {{ modo === 'criar' ? 'Configure o estoque m√≠nimo e m√°ximo para esta linha' : 'Edite as configura√ß√µes de estoque da linha selecionada' }}
        </p>
      </div>

      <form [formGroup]="form" (ngSubmit)="salvarLinha()" class="fabricante-form">
        
        <!-- Campo Plano -->
        <div class="form-group">
          <label for="planoId" class="form-label">
            <i class="cil-list"></i>
            Plano <span class="required">*</span>
          </label>
          <select 
            id="planoId"
            formControlName="planoId" 
            class="form-control"
            [class.is-invalid]="form.get('planoId')?.invalid && form.get('planoId')?.touched"
            [value]="form.get('planoId')?.value"
          >
            <option value="">Selecione o plano</option>
            <option *ngFor="let plano of planos" [value]="plano.id">
              {{ plano.plano }}
            </option>
          </select>
          <div class="invalid-feedback" *ngIf="form.get('planoId')?.invalid && form.get('planoId')?.touched">
            <span *ngIf="form.get('planoId')?.errors?.required">Plano √© obrigat√≥rio</span>
          </div>
          <small class="form-text text-muted">
            Selecione o plano da linha telef√¥nica
          </small>
        </div>

        <!-- Campo Localidade -->
        <div class="form-group">
          <label for="localidadeId" class="form-label">
            <i class="cil-location-pin"></i>
            Localidade <span class="required">*</span>
          </label>
          <select 
            id="localidadeId"
            formControlName="localidadeId" 
            class="form-control"
            [class.is-invalid]="form.get('localidadeId')?.invalid && form.get('localidadeId')?.touched"
            [value]="form.get('localidadeId')?.value"
          >
            <option value="">Selecione a localidade</option>
            <option *ngFor="let localidade of localidadesCompletas" [value]="localidade.id">
              {{ localidade.descricao }}
            </option>
          </select>
          <div class="invalid-feedback" *ngIf="form.get('localidadeId')?.invalid && form.get('localidadeId')?.touched">
            <span *ngIf="form.get('localidadeId')?.errors?.required">Localidade √© obrigat√≥ria</span>
          </div>
          <small class="form-text text-muted">
            Selecione a localidade onde a linha est√° localizada
          </small>
        </div>


        <!-- Campo Estoque M√≠nimo -->
        <div class="form-group">
          <label for="estoqueMinimo" class="form-label">
            <i class="cil-warning"></i>
            Estoque M√≠nimo <span class="required">*</span>
          </label>
          <input 
            type="number" 
            id="estoqueMinimo"
            formControlName="estoqueMinimo" 
            class="form-control"
            [class.is-invalid]="form.get('estoqueMinimo')?.invalid && form.get('estoqueMinimo')?.touched"
            placeholder="Ex: 5"
            min="0"
            maxlength="10"
          >
          <div class="invalid-feedback" *ngIf="form.get('estoqueMinimo')?.invalid && form.get('estoqueMinimo')?.touched">
            <span *ngIf="form.get('estoqueMinimo')?.errors?.required">Estoque m√≠nimo √© obrigat√≥rio</span>
            <span *ngIf="form.get('estoqueMinimo')?.errors?.min">Valor deve ser maior ou igual a 0</span>
          </div>
          <small class="form-text text-muted">
            Quantidade m√≠nima que deve ser mantida em estoque
          </small>
        </div>

        <!-- Campo Estoque M√°ximo -->
        <div class="form-group">
          <label for="estoqueMaximo" class="form-label">
            <i class="cil-check-circle"></i>
            Estoque M√°ximo <span class="required">*</span>
          </label>
          <input 
            type="number" 
            id="estoqueMaximo"
            formControlName="estoqueMaximo" 
            class="form-control"
            [class.is-invalid]="form.get('estoqueMaximo')?.invalid && form.get('estoqueMaximo')?.touched"
            placeholder="Ex: 50"
            min="0"
            maxlength="10"
          >
          <div class="invalid-feedback" *ngIf="form.get('estoqueMaximo')?.invalid && form.get('estoqueMaximo')?.touched">
            <span *ngIf="form.get('estoqueMaximo')?.errors?.required">Estoque m√°ximo √© obrigat√≥rio</span>
            <span *ngIf="form.get('estoqueMaximo')?.errors?.min">Valor deve ser maior ou igual a 0</span>
          </div>
          <small class="form-text text-muted">
            Quantidade m√°xima recomendada para o estoque
          </small>
        </div>


        <!-- Bot√µes de A√ß√£o -->
        <div class="form-actions">
          <button
            type="button"
            class="btn btn-secondary"
            (click)="fecharModal()"
            [disabled]="salvando"
          >
            <i class="fas fa-times"></i>
            Cancelar
          </button>
        
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="form.invalid || salvando"
          >
            <i class="fas fa-save" *ngIf="!salvando"></i>
            <i class="fas fa-spinner fa-spin" *ngIf="salvando"></i>
            {{ modo === 'criar' ? 'Cadastrar' : 'Salvar' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>